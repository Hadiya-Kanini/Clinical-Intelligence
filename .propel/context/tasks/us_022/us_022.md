# User Story - US_022

## Quick Reference Schema
```yaml
# User Story:
  * ID: [US_022]
  * Title: [Implement CSRF protection for state-changing endpoints]
## Description:
   * [As a security officer, I want CSRF protection on all state-changing endpoints, so that cross-site request forgery attacks are prevented.]
## Acceptance Criteria:
   * [Given a state-changing request, When processed, Then CSRF token validation is required.]
## Edge Cases:
   * [What happens when CSRF token expires mid-session?]
## Traceability:
### Parent:
    * [EP-005]
### Tags:
    * [FR-009e, TR-013, Backend, Security]
### Dependencies:
    * [US_011]
```
---

## Story ID
   * ID Format: US_022

## Story Title
   * Implement CSRF protection for state-changing endpoints

## Description
  * As a security officer, I want CSRF protection on all state-changing endpoints when cookie-based auth is used, so that cross-site request forgery attacks are prevented.

## Acceptance Criteria
  * Given a state-changing request (POST, PUT, DELETE), When processed, Then CSRF token validation is required.
  * Given a request without valid CSRF token, When submitted, Then the API returns 403 Forbidden.
  * Given CSRF protection, When implemented, Then tokens are generated per-session and validated server-side.
  * Given the frontend, When making state-changing requests, Then it includes the CSRF token in headers.

## Edge Cases
   * What happens when CSRF token expires mid-session?
   * How does the system handle CSRF for AJAX requests vs form submissions?
   * What happens when the user has multiple tabs with different CSRF tokens?

## Traceability
### Parent Epic
    * Epic : EP-005

### Requirement Tags
    * FR-009e
    * TR-013
    * Backend
    * Security

### Dependencies
    * US_011
