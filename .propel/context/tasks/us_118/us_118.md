# User Story - US_118

## Quick Reference Schema
```yaml
# User Story:
  * ID: [US_118]
  * Title: [Entity Framework Core Migrations Setup]
## Description:
   * [As a developer, I want Entity Framework Core Migrations framework initialized in the .NET Backend API, so that database schema changes can be version-controlled and applied consistently across environments.]
## Acceptance Criteria:
   * [Given the .NET Backend API project, When EF Core packages are installed, Then Microsoft.EntityFrameworkCore and Npgsql.EntityFrameworkCore.PostgreSQL are available]
   * [Given EF Core is configured, When DbContext is created, Then it connects to PostgreSQL using the configured connection string]
   * [Given migrations are initialized, When `dotnet ef migrations add` is run, Then migration files are generated in the Migrations folder]
## Edge Cases:
   * [What happens when connection string is invalid? Clear error message with configuration guidance]
   * [How does system handle migration conflicts? Provide merge resolution steps]
## Traceability:
### Parent:
    * [EP-DB-001]
### Tags:
    * [DR-002, NFR-010, TR-001, Database, Backend, Migrations]
### Dependencies:
    * [US_117 - PostgreSQL Database Installation]
```
---

## Story ID
   * ID Format: US_118

## Story Title
   * Entity Framework Core Migrations Framework Setup

## Description
  * As a developer, I want Entity Framework Core Migrations framework initialized in the .NET Backend API, so that database schema changes can be version-controlled and applied consistently across development, test, and production environments.

## Acceptance Criteria
  * **AC-1**: Given the .NET Backend API project, When EF Core packages are installed, Then Microsoft.EntityFrameworkCore (8.x), Npgsql.EntityFrameworkCore.PostgreSQL, and Microsoft.EntityFrameworkCore.Design are available
  * **AC-2**: Given EF Core is configured, When the ApplicationDbContext is created, Then it successfully connects to PostgreSQL using the configured connection string
  * **AC-3**: Given migrations are initialized, When `dotnet ef migrations add InitialCreate` is executed, Then migration files are generated in the Data/Migrations folder
  * **AC-4**: Given a migration exists, When `dotnet ef database update` is executed, Then the migration is applied to the target database
  * **AC-5**: Given migrations are applied, When `dotnet ef migrations list` is executed, Then all applied and pending migrations are displayed with timestamps

## Edge Cases
   * What happens when connection string is invalid? EF Core must provide clear error message indicating connection failure with configuration guidance
   * How does system handle migration conflicts between branches? Provide documentation for merge resolution using `dotnet ef migrations remove` and re-scaffolding
   * What happens when migration fails mid-execution? Transaction rollback with detailed error logging and recovery steps
   * How does system handle model changes that break existing data? Migration must include data transformation scripts or fail with explicit warning
   * What happens when EF Core tools are not installed? Clear error message with `dotnet tool install` instructions

## Traceability
### Parent Epic
    * Epic: EP-DB-001 - Database Infrastructure & Schema Initialization

### Requirement Tags
    * DR-002 (Referential integrity enforcement)
    * NFR-010 (Maintainability via migrations)
    * TR-001 (API-first architecture)
    * Database, Backend, Migrations

### Dependencies
    * US_117 - PostgreSQL Database Installation with pgvector

## Effort Estimation
   * **Story Points**: 2
   * **Estimated Hours**: 16 hours
   * **Complexity**: Low - Standard EF Core setup with PostgreSQL provider
